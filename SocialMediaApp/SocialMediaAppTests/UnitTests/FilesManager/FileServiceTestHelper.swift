//
//  FileServiceTestHelper.swift
//  SocialMediaApp
//
//  Created by Asad Mehmood on 10/10/2025.
//

import Foundation
import Testing
@testable import SocialMediaApp
import UIKit

class FileServiceTestHelper {
    static func createTestImageFile(fileName: String, folderName: String, directory: Directory) -> URL? {
        guard let baseURL = directory.url else { return nil }
        
        let testFolder = baseURL.appendingPathComponent(folderName)
        let testFile = testFolder.appendingPathComponent(fileName)
        
        do {
            // Create test folder if it doesn't exist
            try FileManager.default.createDirectory(at: testFolder, withIntermediateDirectories: true)
            
            // Create a simple test image (1x1 pixel JPEG)
            let testImageData = createImageData()
            try testImageData.write(to: testFile)
            
            return testFile
        } catch {
            print("Failed to create test image file: \(error)")
            return nil
        }
    }
    
    static func createImageData() -> Data {
        Data([0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xFF, 0xDB, 0x00, 0x43, 0x00, 0x08, 0x06, 0x06, 0x07, 0x06, 0x05, 0x08, 0x07, 0x07, 0x07, 0x09, 0x09, 0x08, 0x0A, 0x0C, 0x14, 0x0D, 0x0C, 0x0B, 0x0B, 0x0C, 0x19, 0x12, 0x13, 0x0F, 0x14, 0x1D, 0x1A, 0x1F, 0x1E, 0x1D, 0x1A, 0x1C, 0x1C, 0x20, 0x24, 0x2E, 0x27, 0x20, 0x22, 0x2C, 0x23, 0x1C, 0x1C, 0x28, 0x37, 0x29, 0x2C, 0x30, 0x31, 0x34, 0x34, 0x34, 0x1F, 0x27, 0x39, 0x3D, 0x38, 0x32, 0x3C, 0x2E, 0x33, 0x34, 0x32, 0xFF, 0xC0, 0x00, 0x11, 0x08, 0x00, 0x01, 0x00, 0x01, 0x01, 0x01, 0x11, 0x00, 0x02, 0x11, 0x01, 0x03, 0x11, 0x01, 0xFF, 0xC4, 0x00, 0x14, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0xFF, 0xC4, 0x00, 0x14, 0x10, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xDA, 0x00, 0x0C, 0x03, 0x01, 0x00, 0x02, 0x11, 0x03, 0x11, 0x00, 0x3F, 0x00, 0xFF, 0xD9])
    }
    
    static func createLargeImageData() -> Data {
           // Create a 100x100 pixel image
           let size = CGSize(width: 100, height: 100)
           let renderer = UIGraphicsImageRenderer(size: size)
           let image = renderer.image { context in
               UIColor.blue.setFill()
               context.fill(CGRect(origin: .zero, size: size))
           }
           return image.pngData() ?? Data()
       }
    
    static func createTestAudioFile(fileName: String, folderName: String, directory: Directory) -> URL? {
        guard let baseURL = directory.url else { return nil }
        
        let testFolder = baseURL.appendingPathComponent(folderName)
        let testFile = testFolder.appendingPathComponent(fileName)
        
        do {
            // Create test folder if it doesn't exist
            try FileManager.default.createDirectory(at: testFolder, withIntermediateDirectories: true)
            
            // Create a simple test audio file (minimal valid MP3)
            let testAudioData = createAudioData()
            try testAudioData.write(to: testFile)
            
            return testFile
        } catch {
            print("Failed to create test audio file: \(error)")
            return nil
        }
    }

    static func createAudioData() -> Data {
        // Minimal valid MP3 file header (MPEG-1 Layer 3, 44.1kHz, mono)
        // This creates a very short silence MP3 file
        Data([
            0xFF, 0xFB, 0x90, 0x00, // MP3 frame sync and header
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x49, 0x6E, 0x66, 0x6F, // "Info" tag
            0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x01
        ])
    }
}
